<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³æ¨‚æ’­æ”¾æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .audio-player {
            margin: 20px 0;
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #4f46e5;
        }
        .info {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 15px;
            margin: 20px 0;
        }
        .error {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin: 20px 0;
            color: #dc2626;
        }
        .success {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
            padding: 15px;
            margin: 20px 0;
            color: #16a34a;
        }
        #log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid #334155;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ é‹’å…„éŸ³æ¨‚æ’­æ”¾æ¸¬è©¦</h1>
        
        <div class="info">
            <strong>æ¸¬è©¦éŸ³é »ï¼š</strong>é‹’å…„é€²åŒ– Showï¼ğŸ”¥é€²è¡Œæ›²<br>
            <strong>ä¾†æºï¼š</strong>Appwrite Storage
        </div>

        <div class="audio-player">
            <audio id="audioPlayer" controls style="width: 100%;">
                æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒéŸ³é »æ’­æ”¾ã€‚
            </audio>
        </div>

        <div>
            <button onclick="testPlay()">â–¶ï¸ æ¸¬è©¦æ’­æ”¾</button>
            <button onclick="testPause()">â¸ï¸ æš«åœ</button>
            <button onclick="testStop()">â¹ï¸ åœæ­¢</button>
            <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤æ—¥èªŒ</button>
        </div>

        <div id="status"></div>
        
        <div id="log"></div>
    </div>

    <script>
        const audioUrl = 'https://fra.cloud.appwrite.io/v1/storage/buckets/6867c5280021205ba9c0/files/697f3cf20030a7bef057/view?project=680c76af0037a7d23e44';
        const audio = document.getElementById('audioPlayer');
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function showStatus(message, type = 'info') {
            statusDiv.className = type;
            statusDiv.innerHTML = `<strong>${type === 'error' ? 'âŒ éŒ¯èª¤' : type === 'success' ? 'âœ… æˆåŠŸ' : 'â„¹ï¸ ä¿¡æ¯'}ï¼š</strong>${message}`;
        }

        function clearLog() {
            logDiv.innerHTML = '';
            statusDiv.innerHTML = '';
        }

        // è¨­ç½®éŸ³é »äº‹ä»¶ç›£è½å™¨
        audio.addEventListener('loadstart', () => {
            log('ğŸ”„ é–‹å§‹åŠ è¼‰éŸ³é »...');
            showStatus('æ­£åœ¨åŠ è¼‰éŸ³é »æ–‡ä»¶...', 'info');
        });

        audio.addEventListener('loadedmetadata', () => {
            log(`âœ… éŸ³é »å…ƒæ•¸æ“šå·²åŠ è¼‰ - æ™‚é•·: ${audio.duration.toFixed(2)}ç§’`);
            showStatus(`éŸ³é »å·²åŠ è¼‰ï¼Œæ™‚é•·: ${audio.duration.toFixed(2)}ç§’`, 'success');
        });

        audio.addEventListener('canplay', () => {
            log('âœ… éŸ³é »å¯ä»¥é–‹å§‹æ’­æ”¾');
        });

        audio.addEventListener('playing', () => {
            log('â–¶ï¸ éŸ³é »æ­£åœ¨æ’­æ”¾');
            showStatus('éŸ³é »æ­£åœ¨æ’­æ”¾ä¸­...', 'success');
        });

        audio.addEventListener('pause', () => {
            log('â¸ï¸ éŸ³é »å·²æš«åœ');
            showStatus('éŸ³é »å·²æš«åœ', 'info');
        });

        audio.addEventListener('ended', () => {
            log('â¹ï¸ éŸ³é »æ’­æ”¾çµæŸ');
            showStatus('æ’­æ”¾å®Œæˆ', 'info');
        });

        audio.addEventListener('error', (e) => {
            const errorMessages = {
                1: 'MEDIA_ERR_ABORTED - ç”¨æˆ¶ä¸­æ­¢äº†éŸ³é »åŠ è¼‰',
                2: 'MEDIA_ERR_NETWORK - ç¶²çµ¡éŒ¯èª¤å°è‡´éŸ³é »ä¸‹è¼‰å¤±æ•—',
                3: 'MEDIA_ERR_DECODE - éŸ³é »è§£ç¢¼å¤±æ•—',
                4: 'MEDIA_ERR_SRC_NOT_SUPPORTED - ä¸æ”¯æŒçš„éŸ³é »æ ¼å¼æˆ–ä¾†æº'
            };
            const errorCode = audio.error ? audio.error.code : 'unknown';
            const errorMsg = errorMessages[errorCode] || `æœªçŸ¥éŒ¯èª¤ (ä»£ç¢¼: ${errorCode})`;
            log(`âŒ éŸ³é »éŒ¯èª¤: ${errorMsg}`, 'error');
            showStatus(`éŸ³é »åŠ è¼‰å¤±æ•—: ${errorMsg}`, 'error');
            
            // è©³ç´°éŒ¯èª¤ä¿¡æ¯
            if (audio.error) {
                log(`   éŒ¯èª¤è©³æƒ…: ${audio.error.message || 'ç„¡è©³ç´°ä¿¡æ¯'}`);
                log(`   ç¶²çµ¡ç‹€æ…‹: ${audio.networkState}`);
                log(`   å°±ç·’ç‹€æ…‹: ${audio.readyState}`);
            }
        });

        audio.addEventListener('timeupdate', () => {
            // æ¯ç§’è¨˜éŒ„ä¸€æ¬¡é€²åº¦
            if (Math.floor(audio.currentTime) % 5 === 0 && audio.currentTime > 0) {
                const progress = ((audio.currentTime / audio.duration) * 100).toFixed(1);
                log(`â±ï¸ æ’­æ”¾é€²åº¦: ${audio.currentTime.toFixed(1)}s / ${audio.duration.toFixed(1)}s (${progress}%)`);
            }
        });

        function testPlay() {
            log('ğŸµ å˜—è©¦æ’­æ”¾éŸ³é »...');
            log(`ğŸ“ éŸ³é » URL: ${audioUrl}`);
            
            if (!audio.src || audio.src !== audioUrl) {
                audio.src = audioUrl;
                log('âœ… å·²è¨­ç½®éŸ³é »ä¾†æº');
            }
            
            audio.play()
                .then(() => {
                    log('âœ… æ’­æ”¾æˆåŠŸå•Ÿå‹•');
                })
                .catch(error => {
                    log(`âŒ æ’­æ”¾å¤±æ•—: ${error.message}`, 'error');
                    showStatus(`æ’­æ”¾å¤±æ•—: ${error.message}`, 'error');
                });
        }

        function testPause() {
            audio.pause();
        }

        function testStop() {
            audio.pause();
            audio.currentTime = 0;
            log('â¹ï¸ å·²åœæ­¢æ’­æ”¾');
        }

        // é é¢åŠ è¼‰æ™‚è‡ªå‹•è¨­ç½®éŸ³é »æº
        window.addEventListener('load', () => {
            log('ğŸš€ æ¸¬è©¦é é¢å·²åŠ è¼‰');
            log(`ğŸ“ éŸ³é » URL: ${audioUrl}`);
            audio.src = audioUrl;
            log('âœ… å·²è¨­ç½®éŸ³é »ä¾†æºï¼Œé»æ“Šã€Œæ¸¬è©¦æ’­æ”¾ã€æŒ‰éˆ•é–‹å§‹');
            showStatus('æº–å‚™å°±ç·’ï¼Œé»æ“Šã€Œæ¸¬è©¦æ’­æ”¾ã€æŒ‰éˆ•', 'info');
        });
    </script>
</body>
</html>
